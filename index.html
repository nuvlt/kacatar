<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚öΩ Ka√ß Atar - Futbol Tahmin Platformu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .match-card {
      transition: all 0.3s ease;
    }
    .match-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .score-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Header -->
  <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-20">
        <a href="/" class="flex items-center gap-3 hover:opacity-80 transition">
          <div class="text-4xl">‚öΩ</div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold">Ka√ß Atar</h1>
            <p class="text-sm text-purple-100">Futbol Tahmin Platformu</p>
          </div>
        </a>
        <nav class="hidden md:flex gap-6 text-sm font-semibold">
          <a href="/" class="hover:text-purple-200 transition">Ma√ßlar</a>
          <a href="/oylarim.html" class="hover:text-purple-200 transition">Tahminlerim</a>
          <a href="/sonuclar.html" class="hover:text-purple-200 transition">Sonu√ßlar</a>
        </nav>
        <button onclick="toggleMobileMenu()" class="md:hidden p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
    <div id="mobileMenu" class="hidden md:hidden bg-white bg-opacity-10 backdrop-blur">
      <nav class="px-4 py-3 space-y-2">
        <a href="/" class="block py-2 px-4 rounded-lg hover:bg-white hover:bg-opacity-20 transition">‚öΩ Ma√ßlar</a>
        <a href="/oylarim.html" class="block py-2 px-4 rounded-lg hover:bg-white hover:bg-opacity-20 transition">üéØ Tahminlerim</a>
        <a href="/sonuclar.html" class="block py-2 px-4 rounded-lg hover:bg-white hover:bg-opacity-20 transition">üìä Sonu√ßlar</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="gradient-bg text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl sm:text-4xl font-bold mb-4">
        üéØ Yakla≈üan Ma√ßlarƒ± Tahmin Et!
      </h2>
      <p class="text-lg text-purple-100 mb-6">
        Favori takƒ±mlarƒ±n i√ßin skor tahmini yap, topluluƒüun ne d√º≈ü√ºnd√ºƒü√ºn√º g√∂r
      </p>
      <div class="flex justify-center gap-4 text-sm">
        <div class="bg-white bg-opacity-20 px-4 py-2 rounded-full backdrop-blur">
          <span class="font-bold" id="totalMatchesCount">-</span> Ma√ß
        </div>
        <div class="bg-white bg-opacity-20 px-4 py-2 rounded-full backdrop-blur">
          <span class="font-bold" id="totalVotesCount">-</span> Tahmin
        </div>
      </div>
    </div>
  </section>

  <!-- Filter Bar -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6 mb-8">
    <div class="bg-white rounded-xl shadow-lg p-4">
      <div class="flex flex-col sm:flex-row gap-4 items-center">
        <div class="flex-1 w-full">
          <input 
            type="text" 
            id="searchInput" 
            placeholder="üîç Takƒ±m ara..." 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          >
        </div>
        <div class="flex gap-2 w-full sm:w-auto overflow-x-auto pb-2 sm:pb-0">
          <button onclick="filterByLeague('all')" class="league-btn whitespace-nowrap px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold shadow-lg">
            üåç T√ºm√º
          </button>
          <button onclick="filterByLeague('CL')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            üèÜ ≈ûL
          </button>
          <button onclick="filterByLeague('PL')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            ‚öΩ Premier
          </button>
          <button onclick="filterByLeague('PD')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            ‚öΩ La Liga
          </button>
          <button onclick="filterByLeague('SA')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            ‚öΩ Serie A
          </button>
          <button onclick="filterByLeague('BL1')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            ‚öΩ Bundesliga
          </button>
          <button onclick="filterByLeague('FL1')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            ‚öΩ Ligue 1
          </button>
          <button onclick="filterByLeague('super-lig')" class="league-btn whitespace-nowrap px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
            üáπüá∑ S√ºper Lig
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Matches Grid -->
  <main id="matches" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <div id="matchesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="col-span-full text-center py-16">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent mb-4"></div>
        <p class="text-gray-500 text-lg">Ma√ßlar y√ºkleniyor...</p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-400">‚öΩ Ka√ß Atar - 2025</p>
      <p class="text-sm text-gray-500 mt-2">Futbol tahmin platformu</p>
    </div>
  </footer>

  <!-- Confetti & Countdown - √ñNCE Y√úKLENSƒ∞N -->
  <script>
    // ========== CONFETTI & SUCCESS MESSAGE ==========
    window.createConfetti = function() {
      const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
      const confettiCount = 50;
      const container = document.createElement('div');
      
      container.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
      `;
      
      document.body.appendChild(container);
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        const size = Math.random() * 10 + 5;
        const color = colors[Math.floor(Math.random() * colors.length)];
        const left = Math.random() * 100;
        const animationDuration = Math.random() * 3 + 2;
        const delay = Math.random() * 0.5;
        
        confetti.style.cssText = `
          position: absolute;
          width: ${size}px;
          height: ${size}px;
          background: ${color};
          top: -10px;
          left: ${left}%;
          opacity: 1;
          transform: rotate(${Math.random() * 360}deg);
          animation: confettiFall ${animationDuration}s linear ${delay}s forwards;
        `;
        
        container.appendChild(confetti);
      }
      
      if (!document.getElementById('confetti-styles')) {
        const style = document.createElement('style');
        style.id = 'confetti-styles';
        style.textContent = `
          @keyframes confettiFall {
            0% {
              transform: translateY(0) rotate(0deg);
              opacity: 1;
            }
            100% {
              transform: translateY(100vh) rotate(720deg);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(style);
      }
      
      setTimeout(() => {
        container.remove();
      }, 5000);
    };

    window.showSuccessMessage = function(prediction) {
      const message = document.createElement('div');
      message.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 3rem;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        z-index: 10000;
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      `;
      
      message.innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 1rem;">üéâ</div>
        <div>Tahminin Kaydedildi!</div>
        <div style="font-size: 2rem; margin-top: 1rem; color: #ffd700;">${prediction}</div>
      `;
      
      if (!document.getElementById('success-styles')) {
        const style = document.createElement('style');
        style.id = 'success-styles';
        style.textContent = `
          @keyframes successPop {
            0% {
              transform: translate(-50%, -50%) scale(0);
              opacity: 0;
            }
            50% {
              transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
              transform: translate(-50%, -50%) scale(1);
              opacity: 1;
            }
          }
        `;
        document.head.appendChild(style);
      }
      
      document.body.appendChild(message);
      
      setTimeout(() => {
        message.style.transition = 'opacity 0.3s, transform 0.3s';
        message.style.opacity = '0';
        message.style.transform = 'translate(-50%, -50%) scale(0.8)';
        setTimeout(() => message.remove(), 300);
      }, 2000);
    };

    window.celebrateVote = function(prediction) {
      window.createConfetti();
      window.showSuccessMessage(prediction);
    };

    // ========== COUNTDOWN TIMER ==========
    window.createCountdown = function(matchDate) {
      const now = new Date();
      const matchTime = new Date(matchDate);
      const diff = matchTime - now;
      
      if (diff > 6 * 60 * 60 * 1000 || diff < 0) {
        return null;
      }
      
      const countdownElement = document.createElement('div');
      countdownElement.className = 'countdown-timer';
      countdownElement.style.cssText = `
        display: inline-block;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: bold;
        margin-left: 0.5rem;
      `;
      
      function updateCountdown() {
        const now = new Date();
        const diff = matchTime - now;
        
        if (diff <= 0) {
          countdownElement.innerHTML = 'üî¥ BA≈ûLADI';
          return;
        }
        
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        let timeText = '';
        if (hours > 0) {
          timeText = `‚è∞ ${hours}s ${minutes}dk`;
        } else {
          timeText = `‚è∞ ${minutes}dk`;
        }
        
        countdownElement.innerHTML = timeText;
      }
      
      updateCountdown();
      const interval = setInterval(updateCountdown, 1000);
      countdownElement.dataset.intervalId = interval;
      
      return countdownElement;
    };

    window.cleanupCountdowns = function() {
      document.querySelectorAll('.countdown-timer').forEach(el => {
        const intervalId = el.dataset.intervalId;
        if (intervalId) {
          clearInterval(Number(intervalId));
        }
      });
    };
  </script>

  <script type="module">
    window.toggleMobileMenu = function() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('hidden');
    };
    
    // ========== FIREBASE & MAIN APP ==========

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDeCQtEWfOyE1hnJHb_W2ktSTqkfUjPJNc",
      authDomain: "kac-atar.firebaseapp.com",
      projectId: "kac-atar",
      storageBucket: "kac-atar.firebasestorage.app",
      messagingSenderId: "1070494452209",
      appId: "1:1070494452209:web:e24a9bbd0b4fb543a79c50",
      measurementId: "G-8ZMRLXBX7Z"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    let currentUser = null;
    let allMatches = [];
    let currentLeague = 'all';

    const PLACEHOLDER = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80'%3E%3Crect width='80' height='80' fill='%23e5e7eb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='32' fill='%239ca3af'%3E%3F%3C/text%3E%3C/svg%3E";

    const leagueNames = {
      'PL': '‚öΩ Premier League',
      'PD': '‚öΩ La Liga',
      'SA': '‚öΩ Serie A',
      'BL1': '‚öΩ Bundesliga',
      'FL1': '‚öΩ Ligue 1',
      'CL': 'üèÜ ≈ûampiyonlar Ligi',
      'super-lig': 'üáπüá∑ S√ºper Lig',
      'S√ºper Lig': 'üáπüá∑ S√ºper Lig',
    };

    signInAnonymously(auth).catch(console.error);
    onAuthStateChanged(auth, (user) => { if (user) currentUser = user; });

    function parseDateField(dateField, timeField) {
      if (!dateField) return null;
      if (typeof dateField === "object" && typeof dateField.seconds === "number")
        return new Date(dateField.seconds * 1000);
      if (typeof dateField === "string") {
        let s = dateField;
        if (/^\d{4}-\d{2}-\d{2}$/.test(s) && timeField) s = `${s}T${timeField}`;
        const d = new Date(s);
        if (!isNaN(d)) return d;
      }
      return null;
    }

    function formatMatchDate(match) {
      const d = parseDateField(match.date, match.time);
      if (d) {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const matchDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
        const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        const tomorrowDate = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());
        
        if (matchDate.getTime() === todayDate.getTime()) {
          return 'üî¥ Bug√ºn ' + d.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        } else if (matchDate.getTime() === tomorrowDate.getTime()) {
          return 'üü¢ Yarƒ±n ' + d.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        }
        return d.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' }) + ' ' + d.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
      }
      return "Tarih bilinmiyor";
    }

    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    async function loadMatches() {
      const container = document.getElementById('matchesContainer');

      try {
        const querySnapshot = await getDocs(collection(db, "matches"));
        allMatches = [];
        
        querySnapshot.forEach((docSnap) => {
          const m = docSnap.data() || {};
          m._id = docSnap.id;
          allMatches.push(m);
        });

        allMatches.sort((a, b) => {
          const da = parseDateField(a.date, a.time);
          const db = parseDateField(b.date, b.time);
          if (da && db) return da - db;
          if (da) return -1;
          if (db) return 1;
          return 0;
        });

        updateStats();
        renderMatches();
      } catch (error) {
        console.error("Matches load error:", error);
        container.innerHTML = '<div class="col-span-full text-center text-red-500 py-8">‚ùå Ma√ßlar y√ºklenemedi</div>';
      }
    }

    function updateStats() {
      const totalVotes = allMatches.reduce((sum, m) => sum + (m.voteCount || 0), 0);
      document.getElementById('totalMatchesCount').textContent = allMatches.length;
      document.getElementById('totalVotesCount').textContent = totalVotes;
    }

    function renderMatches() {
      const container = document.getElementById('matchesContainer');
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      // √ñnce eski countdown'larƒ± temizle
      window.cleanupCountdowns();

      let filtered = allMatches.filter(match => {
        // ‚ö° YENƒ∞: Ma√ß saati ge√ßmi≈ü mi kontrol et
        const matchDate = parseDateField(match.date, match.time);
        if (matchDate) {
          const now = new Date();
          const hoursSinceMatch = (now - matchDate) / (1000 * 60 * 60);
          
          // Ma√ßtan 3 saat ge√ßtiyse g√∂sterme (90dk + uzatmalar + buffer)
          if (hoursSinceMatch > 2) {
            return false;
          }
        }

        // League filter
        if (currentLeague !== 'all') {
          const matchLeague = match.league || match.competition;
          
          if (currentLeague === 'super-lig') {
            const isSuperlig = matchLeague === 'super-lig' || 
                              matchLeague === 'S√ºper Lig' ||
                              match.competition === 'super-lig';
            if (!isSuperlig) return false;
          } else {
            if (matchLeague !== currentLeague) return false;
          }
        }

        if (searchTerm) {
          const home = (match.home || "").toLowerCase();
          const away = (match.away || "").toLowerCase();
          return home.includes(searchTerm) || away.includes(searchTerm);
        }

        return true;
      });

      if (filtered.length === 0) {
        container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-16"><div class="text-6xl mb-4">üòî</div><p class="text-xl">Ma√ß bulunamadƒ±</p></div>';
        return;
      }

      container.innerHTML = filtered.map(match => {
        const matchId = match._id;
        const home = match.home || "Bilinmiyor";
        const away = match.away || "Bilinmiyor";
        const homeLogo = (match.homeLogo && match.homeLogo !== "") ? match.homeLogo : PLACEHOLDER;
        const awayLogo = (match.awayLogo && match.awayLogo !== "") ? match.awayLogo : PLACEHOLDER;
        const dateText = formatMatchDate(match);
        const leagueName = leagueNames[match.league] || match.league || "";
        const popularText = match.popularPrediction || "‚Äî";
        const voteCount = match.voteCount || 0;
        
        // Countdown i√ßin ma√ß tarihi kontrol√º
        const matchDate = parseDateField(match.date, match.time);
        const now = new Date();
        const timeDiff = matchDate ? (matchDate - now) : null;
        const showCountdown = timeDiff && timeDiff > 0 && timeDiff < 6 * 60 * 60 * 1000;
        
        console.log(`Match: ${home} vs ${away}, Date: ${matchDate}, Diff: ${timeDiff ? Math.round(timeDiff/1000/60) + ' min' : 'N/A'}, Show: ${showCountdown}`);

        return `
          <div class="match-card bg-white rounded-2xl shadow-md overflow-hidden" data-id="${matchId}" data-match-date="${matchDate ? matchDate.toISOString() : ''}">
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 text-white text-sm font-semibold flex justify-between items-center">
              <div class="flex items-center gap-2">
                <span>${leagueName}</span>
                <span class="countdown-container-inline"></span>
              </div>
              <span class="text-xs opacity-90">${dateText}</span>
            </div>

            <div class="p-6">
              <div class="grid grid-cols-3 gap-4 items-center mb-6">
                <div class="text-center">
                  <img src="${homeLogo}" alt="${escapeHtml(home)}" class="w-16 h-16 mx-auto mb-2 object-contain" onerror="this.src='${PLACEHOLDER}'">
                  <p class="font-bold text-sm text-gray-800">${escapeHtml(home)}</p>
                </div>

                <div class="text-center">
                  <span class="text-2xl font-bold text-gray-300">VS</span>
                </div>

                <div class="text-center">
                  <img src="${awayLogo}" alt="${escapeHtml(away)}" class="w-16 h-16 mx-auto mb-2 object-contain" onerror="this.src='${PLACEHOLDER}'">
                  <p class="font-bold text-sm text-gray-800">${escapeHtml(away)}</p>
                </div>
              </div>

              <div class="flex items-center justify-center gap-3 mb-4">
                <input 
                  type="number" 
                  min="0" 
                  max="20" 
                  placeholder="0"
                  class="score-input home-score w-16 h-16 text-center text-2xl font-bold border-2 border-gray-200 rounded-xl"
                >
                <span class="text-3xl font-bold text-gray-400">-</span>
                <input 
                  type="number" 
                  min="0" 
                  max="20" 
                  placeholder="0"
                  class="score-input away-score w-16 h-16 text-center text-2xl font-bold border-2 border-gray-200 rounded-xl"
                >
              </div>

              <button class="vote-button w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transition transform hover:scale-105">
                üéØ Tahmin Et
              </button>

              <div class="mt-4 p-3 bg-gray-50 rounded-xl text-center">
                <p class="text-xs text-gray-500 mb-1">En Pop√ºler Tahmin</p>
                <p class="font-bold text-lg text-purple-600">${escapeHtml(popularText)}</p>
                <p class="text-xs text-gray-400 mt-1">${voteCount} ki≈üi tahmin yaptƒ±</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // Countdown timer'larƒ± ekle
      document.querySelectorAll('.match-card').forEach(card => {
        const matchDate = card.dataset.matchDate;
        const countdownContainer = card.querySelector('.countdown-container-inline');
        if (matchDate && countdownContainer) {
          const countdown = window.createCountdown(matchDate);
          if (countdown) {
            countdownContainer.appendChild(countdown);
          }
        }
      });
    }

    window.filterByLeague = function(league) {
      currentLeague = league;
      
      document.querySelectorAll('.league-btn').forEach(btn => {
        btn.classList.remove('bg-purple-600', 'text-white', 'shadow-lg');
        btn.classList.add('bg-gray-100');
      });
      event.target.classList.remove('bg-gray-100');
      event.target.classList.add('bg-purple-600', 'text-white', 'shadow-lg');
      
      renderMatches();
    };

    document.getElementById('searchInput').addEventListener('input', renderMatches);

    // Vote handler - G√úVENL√Ñ¬∞ BACKEND VERS√Ñ¬∞YONU
    document.addEventListener("click", async (e) => {
      if (e.target.closest(".vote-button")) {
        const btn = e.target.closest(".vote-button");
        const card = e.target.closest(".match-card");
        const matchId = card.dataset.id;
        const homeScore = card.querySelector(".home-score").value;
        const awayScore = card.querySelector(".away-score").value;

        if (!homeScore || !awayScore) {
          alert("‚ö†Ô∏è L√ºtfen her iki takƒ±m i√ßin de skor girin!");
          return;
        }

        if (!currentUser) {
          alert("‚ö†Ô∏è L√ºtfen bekleyin, giri≈ü yapƒ±lƒ±yor...");
          return;
        }

        const prediction = `${homeScore}-${awayScore}`;

        // Button disabled
        btn.disabled = true;
        btn.textContent = "‚è≥ Kaydediliyor...";

        try {
          // Backend API'ye g√∂nder
          const response = await fetch('/api/submit-vote', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              matchId: matchId,
              prediction: prediction,
              userId: currentUser.uid
            })
          });

          const result = await response.json();

          if (response.ok && result.ok) {
            // ‚ú® CONFETT√Ñ¬∞ & SUCCESS MESAJI
            if (window.celebrateVote) {
              window.celebrateVote(prediction);
            }
            
            // 2.5 saniye sonra reload (animasyon bitsin diye)
            setTimeout(async () => {
              await loadMatches();
            }, 2500);
          } else {
            alert(`‚ùå ${result.error || result.message || 'Tahmin kaydedilemedi'}`);
          }
        } catch (err) {
          console.error("Vote error:", err);
          alert("‚ùå Baƒülantƒ± hatasƒ±: " + err.message);
        } finally {
          btn.disabled = false;
          btn.textContent = "üéØ Tahmin Et";
        }
      }
    });

    loadMatches();
  </script>
</body>
</html>

